{"ast":null,"code":"import goodsApi from '@/api/warehouse/GoodsApi';\nimport provinceApi from '@/api/cmn/ProvinceApi';\nimport cityApi from '@/api/cmn/CityApi';\nimport countyApi from '@/api/cmn/CountyApi';\nimport imgApi from '@/api/api/ImgApi';\nexport default {\n  name: \"Goods\",\n\n  data() {\n    return {\n      page: 1,\n      // 查询第几页\n      limit: 5,\n      // 每条记录数\n      goodsQueryVo: {\n        // 商品条件查询对象\n        province: null,\n        city: null,\n        county: null,\n        name: \"\",\n        priceStart: null,\n        priceEnd: null\n      },\n      goodsVo: {\n        // 添加商品数据 vo 对象\n        province: null,\n        city: null,\n        county: null,\n        name: null,\n        price: null,\n        img: '',\n        description: ''\n      },\n      goodsList: [],\n      total: 0,\n      provinces: [],\n      cities: [],\n      counties: [],\n      addGoodsVisible: false,\n      imageUrl: '',\n      // 上传图片路径\n      detailsGoods: {\n        // 商品细节对象\n        name: \"\",\n        id: \"\",\n        number: 0,\n        price: 0,\n        img: \"\",\n        description: \"\",\n        state: 0,\n        address: ''\n      },\n      detailGoodsVisible: false,\n      GoodsInOrderVisible: false,\n      inOrder: {\n        id: null,\n        number: 0\n      },\n      inOrderName: ''\n    };\n  },\n\n  created() {\n    this.initGoods();\n  },\n\n  methods: {\n    goodsInOrder(goods) {\n      // 商品入库操作\n      this.inOrderName = goods.name;\n      this.inOrder.id = goods.id;\n      this.GoodsInOrderVisible = true;\n    },\n\n    detailGoods(goods) {\n      // 查看商品的详细信息\n      goodsApi.get(goods.id).then(resp => {\n        this.detailsGoods = resp.data.data;\n      });\n      this.detailGoodsVisible = true;\n    },\n\n    updateState(goods) {\n      // 更新商品状态\n      console.log(\"state = \" + goods.state);\n      goodsApi.updateState(goods.id, goods.state === 1 ? 0 : 1).then(resp => {\n        this.pageFindGoods();\n      });\n    },\n\n    deleteGoods(goods) {\n      // 删除商品\n      this.$confirm('此操作将永久删除' + goods.name + '，并且连同删除其相关的订单信息, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        console.log(\"id = \" + goods.id);\n        goodsApi.deleteGoods(goods.id).then(resp => {\n          if (resp.data.code === 200) {\n            this.$message({\n              type: 'success',\n              message: '删除成功!'\n            });\n            this.pageFindGoods();\n          } else {\n            this.$message.error('删除失败，服务器出了点小问题');\n          }\n        });\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: '已取消删除'\n        });\n      });\n    },\n\n    addGoods() {\n      // 添加信息商品\n      if (!this.goodsVo.province) {\n        this.$message.error('请选择省份');\n        return;\n      }\n\n      if (!this.goodsVo.city) {\n        this.$message.error('请选择城市');\n        return;\n      }\n\n      if (!this.goodsVo.county) {\n        this.$message.error('请选择区县');\n        return;\n      }\n\n      if (!this.goodsVo.name) {\n        this.$message.error('请输入商品名称');\n        return;\n      }\n\n      if (!this.goodsVo.price) {\n        this.$message.error('请输入商品价格');\n        return;\n      }\n\n      if (isNaN(this.goodsVo.price)) {\n        this.$message.error('价格输入不正确');\n        return;\n      }\n\n      if (!this.goodsVo.description) {\n        this.$message.error('请输入描述！');\n        return;\n      }\n\n      if (!this.goodsVo.img) {\n        this.$message.error('请上传图片');\n        return;\n      }\n\n      goodsApi.add(this.goodsVo).then(resp => {\n        if (resp.data.code === 200) {\n          this.$message.success('添加成功！');\n          this.addGoodsVisible = false;\n          this.pageFindGoods();\n        } else {\n          this.$message.error('添加失败！');\n        }\n      });\n    },\n\n    initGoods() {\n      // 初始化页面函数\n      this.pageFindGoods();\n      this.getAllProvinces();\n    },\n\n    pageFindGoods() {\n      // 分页查找商品信息\n      goodsApi.pageFind(this.page, this.limit, this.goodsQueryVo).then(resp => {\n        this.goodsList = resp.data.data.records;\n        this.total = resp.data.data.total;\n      });\n    },\n\n    getAllProvinces() {\n      // 获取所有省\n      provinceApi.getAllProvinces().then(resp => {\n        this.provinces = resp.data.data;\n      });\n    },\n\n    getCities() {\n      this.goodsQueryVo.city = null;\n      this.goodsQueryVo.county = null;\n      this.getAllCitiesByParentId(this.goodsQueryVo.province);\n    },\n\n    getCitiesVo() {\n      this.goodsVo.city = null;\n      this.goodsVo.county = null;\n      this.getAllCitiesByParentId(this.goodsVo.province);\n    },\n\n    getAllCitiesByParentId(provinceId) {\n      // 获取省下所有市\n      this.cities = [];\n      this.counties = [];\n      cityApi.getAllCitiesByParentId(provinceId).then(resp => {\n        this.cities = resp.data.data;\n      });\n    },\n\n    getCountiesVo() {\n      this.goodsVo.county = null;\n      this.getCountiesByParentId(this.goodsVo.city);\n    },\n\n    getCounties() {\n      this.goodsQueryVo.county = null;\n      this.getCountiesByParentId(this.goodsQueryVo.city);\n    },\n\n    getCountiesByParentId(cityId) {\n      // 获取市下所有区县\n      this.counties = [];\n      countyApi.getCountiesByParentId(cityId).then(resp => {\n        this.counties = resp.data.data;\n      });\n    },\n\n    handleSizeChange(limit) {\n      // 一页数量修改\n      this.limit = limit;\n      this.pageFindGoods();\n    },\n\n    handleCurrentChange(page) {\n      // 页码数量修改\n      this.page = page;\n      this.pageFindGoods();\n    },\n\n    showAddGoodsVisible() {\n      // 打开对话框\n      this.goodsVo = {\n        province: null,\n        city: null,\n        county: null,\n        name: null,\n        price: null,\n        img: '',\n        description: ''\n      };\n      this.addGoodsVisible = true;\n    },\n\n    imgUploadSuccess(resp) {\n      this.goodsVo.img = resp.data;\n      console.log(this.goodsVo.img);\n    },\n\n    handleRemove() {\n      // 删除图片操作\n      imgApi.deleteImage(this.goodsVo.img);\n      this.goodsVo.img = '';\n    },\n\n    cancelToAddGoods() {\n      // 取消添加 新商品\n      this.addGoodsVisible = false;\n      this.handleRemove();\n    }\n\n  }\n};","map":{"version":3,"mappings":"AAkRA;AACA;AACA;AACA;AACA;AAEA;EACAA,aADA;;EAEAC;IACA;MACAC,OADA;MACA;MACAC,QAFA;MAEA;MACAC;QAAA;QACAC,cADA;QAEAC,UAFA;QAGAC,YAHA;QAIAP,QAJA;QAKAQ,gBALA;QAMAC;MANA,CAHA;MAWAC;QAAA;QACAL,cADA;QAEAC,UAFA;QAGAC,YAHA;QAIAP,UAJA;QAKAW,WALA;QAMAC,OANA;QAOAC;MAPA,CAXA;MAoBAC,aApBA;MAqBAC,QArBA;MAsBAC,aAtBA;MAuBAC,UAvBA;MAwBAC,YAxBA;MAyBAC,sBAzBA;MA0BAC,YA1BA;MA0BA;MACAC;QAAA;QACArB,QADA;QAEAsB,MAFA;QAGAC,SAHA;QAIAZ,QAJA;QAKAC,OALA;QAMAC,eANA;QAOAW,QAPA;QAQAC;MARA,CA3BA;MAqCAC,yBArCA;MAsCAC,0BAtCA;MAuCAC;QACAN,QADA;QAEAC;MAFA,CAvCA;MA2CAM;IA3CA;EA6CA,CAhDA;;EAiDAC;IACA;EACA,CAnDA;;EAoDAC;IACAC;MAAA;MACA;MACA;MACA;IACA,CALA;;IAMAC;MAAA;MACAC;QACA;MACA,CAFA;MAIA;IACA,CAZA;;IAaAC;MAAA;MACAC;MACAF;QACA;MACA,CAFA;IAGA,CAlBA;;IAmBAG;MAAA;MACA;QACAC,uBADA;QAEAC,sBAFA;QAGAC;MAHA,GAIAC,IAJA,CAIA;QACAL;QACAF;UACA;YACA;cACAM,eADA;cAEAE;YAFA;YAIA;UACA,CANA,MAMA;YACA;UACA;QACA,CAVA;MAWA,CAjBA,EAiBAC,KAjBA,CAiBA;QACA;UACAH,YADA;UAEAE;QAFA;MAIA,CAtBA;IAuBA,CA3CA;;IA4CAE;MAAA;MACA;QACA;QACA;MACA;;MACA;QACA;QACA;MACA;;MACA;QACA;QACA;MACA;;MACA;QACA;QACA;MACA;;MACA;QACA;QACA;MACA;;MACA;QACA;QACA;MACA;;MACA;QACA;QACA;MACA;;MACA;QACA;QACA;MACA;;MACAV;QACA;UACA;UACA;UACA;QACA,CAJA,MAIA;UACA;QACA;MACA,CARA;IASA,CAtFA;;IAuFAW;MAAA;MACA;MACA;IACA,CA1FA;;IA2FAC;MAAA;MACAZ;QACA;QACA;MACA,CAHA;IAIA,CAhGA;;IAiGAa;MAAA;MAEAC;QACA;MACA,CAFA;IAGA,CAtGA;;IAuGAC;MACA;MACA;MACA;IACA,CA3GA;;IA4GAC;MACA;MACA;MACA;IACA,CAhHA;;IAiHAC;MAAA;MACA;MACA;MACAC;QACA;MACA,CAFA;IAGA,CAvHA;;IAwHAC;MACA;MACA;IACA,CA3HA;;IA4HAC;MACA;MACA;IACA,CA/HA;;IAgIAC;MAAA;MACA;MACAC;QACA;MACA,CAFA;IAGA,CArIA;;IAsIAC;MAAA;MACA;MACA;IACA,CAzIA;;IA0IAC;MAAA;MACA;MACA;IACA,CA7IA;;IA8IAC;MAAA;MACA;QACAtD,cADA;QAEAC,UAFA;QAGAC,YAHA;QAIAP,UAJA;QAKAW,WALA;QAMAC,OANA;QAOAC;MAPA;MASA;IACA,CAzJA;;IA0JA+C;MACA;MACAxB;IACA,CA7JA;;IA8JAyB;MAAA;MACAC;MACA;IACA,CAjKA;;IAkKAC;MAAA;MACA;MACA;IACA;;EArKA;AApDA","names":["name","data","page","limit","goodsQueryVo","province","city","county","priceStart","priceEnd","goodsVo","price","img","description","goodsList","total","provinces","cities","counties","addGoodsVisible","imageUrl","detailsGoods","id","number","state","address","detailGoodsVisible","GoodsInOrderVisible","inOrder","inOrderName","created","methods","goodsInOrder","detailGoods","goodsApi","updateState","console","deleteGoods","confirmButtonText","cancelButtonText","type","then","message","catch","addGoods","initGoods","pageFindGoods","getAllProvinces","provinceApi","getCities","getCitiesVo","getAllCitiesByParentId","cityApi","getCountiesVo","getCounties","getCountiesByParentId","countyApi","handleSizeChange","handleCurrentChange","showAddGoodsVisible","imgUploadSuccess","handleRemove","imgApi","cancelToAddGoods"],"sourceRoot":"src/views/warehouse","sources":["Goods.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <div style=\"height: 70px\">\r\n\r\n            <!-- 顶部操作栏位 -->\r\n            <div style=\"float:left;\">\r\n                <el-button type=\"success\" plain @click=\"showAddGoodsVisible\">添加商品</el-button>\r\n            </div>\r\n            <div style=\"float:left;padding-left: 40px\">\r\n                <div style=\"float: left\">\r\n                    <el-input v-model=\"goodsQueryVo.name\" placeholder=\"请输入商品名称\"></el-input>\r\n                </div>\r\n                <div style=\"float: left;width: 100px;padding-left: 5px\">\r\n                    <el-select v-model=\"goodsQueryVo.province\" placeholder=\"选择省\" @change=\"getCities\">\r\n                        <el-option\r\n                                v-for=\"item in provinces\"\r\n                                :key=\"item.id\"\r\n                                :label=\"item.value\"\r\n                                :value=\"item.id\">\r\n                        </el-option>\r\n                    </el-select>\r\n                </div>\r\n                <div style=\"float: left;width: 100px;padding-left: 5px\">\r\n                    <el-select v-model=\"goodsQueryVo.city\" :disabled=\"!goodsQueryVo.province\" placeholder=\"选择市\"\r\n                               @change=\"getCounties\">\r\n                        <el-option\r\n                                v-for=\"item in cities\"\r\n                                :key=\"item.id\"\r\n                                :label=\"item.value\"\r\n                                :value=\"item.id\">\r\n                        </el-option>\r\n                    </el-select>\r\n                </div>\r\n                <div style=\"float: left;width: 100px;padding-left: 5px\">\r\n                    <el-select v-model=\"goodsQueryVo.county\" :disabled=\"!goodsQueryVo.city\" placeholder=\"选择区\">\r\n                        <el-option\r\n                                v-for=\"item in counties\"\r\n                                :key=\"item.id\"\r\n                                :label=\"item.value\"\r\n                                :value=\"item.id\">\r\n                        </el-option>\r\n                    </el-select>\r\n                </div>\r\n                <div style=\"float:left;padding-left: 10px;width: 130px\">\r\n                    <el-input v-model=\"goodsQueryVo.priceStart\" placeholder=\"起始价格\"></el-input>\r\n                </div>\r\n                <div style=\"float:left;padding-left: 10px;width: 130px\">\r\n                    <el-input v-model=\"goodsQueryVo.priceEnd\" placeholder=\"终止价格\"></el-input>\r\n                </div>\r\n                <div style=\"float: left; padding-left: 10px\">\r\n                    <el-button type=\"primary\" plain icon=\"el-icon-search\" @click=\"pageFindGoods\"></el-button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- 查询得到的商品展示栏位 -->\r\n        <div>\r\n            <template>\r\n                <el-table\r\n                        :data=\"goodsList\"\r\n                        stripe\r\n                        height=\"700px\"\r\n                        style=\"width: 100%\">\r\n                    <el-table-column\r\n                            label=\"图片\"\r\n                            width=\"120\">\r\n                        <template slot-scope=\"scope\">\r\n                            <img :src=\"scope.row.img\" width=\"100px\" height=\"100px\">\r\n                        </template>\r\n                    </el-table-column>\r\n                    <el-table-column\r\n                            prop=\"name\"\r\n                            label=\"名称\"\r\n                            width=\"180\">\r\n                    </el-table-column>\r\n                    <el-table-column\r\n                            prop=\"id\"\r\n                            label=\"商品编号\"\r\n                            width=\"180\">\r\n                    </el-table-column>\r\n                    <el-table-column\r\n                            prop=\"number\"\r\n                            label=\"数量/个\"\r\n                            width=\"100\">\r\n                    </el-table-column>\r\n                    <el-table-column\r\n                            prop=\"price\"\r\n                            label=\"价格/元\"\r\n                            width=\"100\">\r\n                    </el-table-column>\r\n                    <el-table-column\r\n                            prop=\"description\"\r\n                            label=\"描述\"\r\n                            width=\"340\">\r\n                    </el-table-column>\r\n                    <el-table-column\r\n                            label=\"操作\"\r\n                            width=\"400\">\r\n                        <template slot-scope=\"scope\">\r\n                            <el-button type=\"primary\" round @click=\"detailGoods(scope.row)\">详细信息</el-button>\r\n                            <el-button type=\"danger\" round @click=\"deleteGoods(scope.row)\">销毁</el-button>\r\n                            <el-button v-if=\"scope.row.state === 0\" type=\"success\" round\r\n                                       @click=\"updateState(scope.row)\">上架\r\n                            </el-button>\r\n                            <el-button v-if=\"scope.row.state === 1\" type=\"warning\" round\r\n                                       @click=\"updateState(scope.row)\">下架\r\n                            </el-button>\r\n                            <el-button type=\"success\" round @click=\"goodsInOrder(scope)\">入库</el-button>\r\n                        </template>\r\n                    </el-table-column>\r\n                </el-table>\r\n            </template>\r\n        </div>\r\n\r\n        <!-- 分页功能部位 -->\r\n        <div>\r\n            <div class=\"block\">\r\n                <el-pagination\r\n                        @size-change=\"handleSizeChange\"\r\n                        @current-change=\"handleCurrentChange\"\r\n                        :page-sizes=\"[5, 10, 15, 20]\"\r\n                        :page-size=\"5\"\r\n                        layout=\"total, sizes, prev, pager, next, jumper\"\r\n                        :total=\"total\">\r\n                </el-pagination>\r\n            </div>\r\n        </div>\r\n        <div>\r\n            <el-dialog title=\"商品信息\" :visible.sync=\"addGoodsVisible\">\r\n                <el-form :model=\"goodsVo\">\r\n                    <el-row :gutter=\"20\">\r\n                        <el-col :span=\"6\">\r\n                            <div class=\"grid-content bg-purple\">\r\n                                <el-form-item label=\"商品名称\">\r\n                                    <el-input v-model=\"goodsVo.name\" autocomplete=\"off\"></el-input>\r\n                                </el-form-item>\r\n                            </div>\r\n                        </el-col>\r\n                        <el-col :span=\"18\">\r\n                            <div class=\"grid-content bg-purple\">\r\n                                <el-form-item label=\"商品描述\">\r\n                                    <el-input v-model=\"goodsVo.description\" autocomplete=\"off\"></el-input>\r\n                                </el-form-item>\r\n                            </div>\r\n                        </el-col>\r\n                        <el-col :span=\"6\">\r\n                            <div class=\"grid-content bg-purple\">\r\n                                <el-form-item label=\"省份\">\r\n                                    <el-select v-model=\"goodsVo.province\" placeholder=\"请选择\"\r\n                                               @change=\"getCitiesVo\">\r\n                                        <el-option\r\n                                                v-for=\"item in provinces\"\r\n                                                :key=\"item.id\"\r\n                                                :label=\"item.value\"\r\n                                                :value=\"item.id\">\r\n                                        </el-option>\r\n                                    </el-select>\r\n                                </el-form-item>\r\n                            </div>\r\n                        </el-col>\r\n                        <el-col :span=\"6\">\r\n                            <div class=\"grid-content bg-purple\">\r\n                                <el-form-item label=\"城市\">\r\n                                    <el-select v-model=\"goodsVo.city\" :disabled=\"!goodsVo.province\" placeholder=\"请选择\"\r\n                                               @change=\"getCountiesVo\">\r\n                                        <el-option\r\n                                                v-for=\"item in cities\"\r\n                                                :key=\"item.id\"\r\n                                                :label=\"item.value\"\r\n                                                :value=\"item.id\">\r\n                                        </el-option>\r\n                                    </el-select>\r\n                                </el-form-item>\r\n                            </div>\r\n                        </el-col>\r\n                        <el-col :span=\"6\">\r\n                            <div class=\"grid-content bg-purple\">\r\n                                <el-form-item label=\"区县\">\r\n                                    <el-select v-model=\"goodsVo.county\" placeholder=\"请选择\" :disabled=\"!goodsVo.city\">\r\n                                        <el-option\r\n                                                v-for=\"item in counties\"\r\n                                                :key=\"item.id\"\r\n                                                :label=\"item.value\"\r\n                                                :value=\"item.id\">\r\n                                        </el-option>\r\n                                    </el-select>\r\n                                </el-form-item>\r\n                            </div>\r\n                        </el-col>\r\n                        <el-col :span=\"6\">\r\n                            <div class=\"grid-content bg-purple\">\r\n                                <el-form-item label=\"价格\">\r\n                                    <el-input v-model=\"goodsVo.price\" placeholder=\"请输入价格\"></el-input>\r\n                                </el-form-item>\r\n                            </div>\r\n                        </el-col>\r\n                        <el-col :span=\"6\">\r\n                            <div class=\"grid-content bg-purple\">\r\n                                <el-form-item label=\"上传\">\r\n                                    <el-upload\r\n                                            class=\"upload-demo\"\r\n                                            action=\"http://192.168.195.130:80/log/api/img/upload\"\r\n                                            multiple\r\n                                            :on-remove=\"handleRemove\"\r\n                                            :on-success=\"imgUploadSuccess\">\r\n                                        <el-button size=\"small\" type=\"primary\">点击上传</el-button>\r\n                                        <div slot=\"tip\" class=\"el-upload__tip\">只能上传jpg/png文件，且不超过2Mb</div>\r\n                                    </el-upload>\r\n                                </el-form-item>\r\n                            </div>\r\n                        </el-col>\r\n                        <el-col :span=\"6\">\r\n                            <div class=\"grid-content bg-purple\">\r\n                                <el-form-item label=\"图片\">\r\n                                    <img :src=\"goodsVo.img\" alt=\"\" width=\"200px\">\r\n                                </el-form-item>\r\n                            </div>\r\n                        </el-col>\r\n                    </el-row>\r\n                </el-form>\r\n                <div slot=\"footer\" class=\"dialog-footer\">\r\n                    <el-button @click=\"cancelToAddGoods\">取 消</el-button>\r\n                    <el-button type=\"primary\" @click=\"addGoods\">确 定</el-button>\r\n                </div>\r\n            </el-dialog>\r\n        </div>\r\n\r\n\r\n        <div>\r\n            <!-- 商品详细信息 -->\r\n            <el-dialog :visible.sync=\"detailGoodsVisible\">\r\n                <el-descriptions title=\"商品信息\">\r\n                    <el-descriptions-item label=\"名称\">{{detailsGoods.name}}</el-descriptions-item>\r\n                    <el-descriptions-item label=\"数量\">\r\n                        <el-tag type=\"success\" size=\"small\">{{detailsGoods.number}}</el-tag>\r\n                    </el-descriptions-item>\r\n                    <el-descriptions-item label=\"价格\">\r\n                        <el-tag type=\"success\" size=\"small\">{{detailsGoods.price}}</el-tag>\r\n                    </el-descriptions-item>\r\n                    <el-descriptions-item label=\"\">\r\n                        <el-tag size=\"small\">学校</el-tag>\r\n                    </el-descriptions-item>\r\n                    <el-descriptions-item label=\"描述\">{{detailsGoods.description}}</el-descriptions-item>\r\n                    <el-descriptions-item label=\"地址\">{{detailsGoods.address}}</el-descriptions-item>\r\n                    <el-descriptions-item label=\"图片\">\r\n                        <el-image\r\n                                style=\"width: 100px; height: 100px\"\r\n                                :src=\"detailsGoods.img\"></el-image>\r\n                    </el-descriptions-item>\r\n                </el-descriptions>\r\n                <div slot=\"footer\" class=\"dialog-footer\">\r\n                    <el-button @click=\"detailGoodsVisible = false\">关 闭</el-button>\r\n                </div>\r\n            </el-dialog>\r\n        </div>\r\n        <div>\r\n            <el-dialog :visible.sync=\"GoodsInOrderVisible\">\r\n                <el-descriptions title=\"商品入库\">\r\n                    <el-descriptions-item label=\"名称\">{{inOrderName}}</el-descriptions-item>\r\n                    <el-descriptions-item label=\"入库数量\">\r\n                        <el-input v-model=\"inOrder.number\" placeholder=\"输入入库数量\"></el-input>\r\n                    </el-descriptions-item>\r\n                </el-descriptions>\r\n                <div slot=\"footer\" class=\"dialog-footer\">\r\n                    <el-button @click=\"GoodsInOrderVisible = false\">关 闭</el-button>\r\n                    <el-button @click=\"GoodsInOrderVisible = false\">确 定</el-button>\r\n                </div>\r\n            </el-dialog>\r\n        </div>\r\n\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import goodsApi from '@/api/warehouse/GoodsApi'\r\n    import provinceApi from '@/api/cmn/ProvinceApi'\r\n    import cityApi from '@/api/cmn/CityApi'\r\n    import countyApi from '@/api/cmn/CountyApi'\r\n    import imgApi from '@/api/api/ImgApi'\r\n\r\n    export default {\r\n        name: \"Goods\",\r\n        data() {\r\n            return {\r\n                page: 1,            // 查询第几页\r\n                limit: 5,           // 每条记录数\r\n                goodsQueryVo: {     // 商品条件查询对象\r\n                    province: null,\r\n                    city: null,\r\n                    county: null,\r\n                    name: \"\",\r\n                    priceStart: null,\r\n                    priceEnd: null\r\n                },\r\n                goodsVo: {          // 添加商品数据 vo 对象\r\n                    province: null,\r\n                    city: null,\r\n                    county: null,\r\n                    name: null,\r\n                    price: null,\r\n                    img: '',\r\n                    description: ''\r\n                },\r\n                goodsList: [],\r\n                total: 0,\r\n                provinces: [],\r\n                cities: [],\r\n                counties: [],\r\n                addGoodsVisible: false,\r\n                imageUrl: '',  // 上传图片路径\r\n                detailsGoods: {  // 商品细节对象\r\n                    name: \"\",\r\n                    id: \"\",\r\n                    number: 0,\r\n                    price: 0,\r\n                    img: \"\",\r\n                    description: \"\",\r\n                    state: 0,\r\n                    address: ''\r\n                },\r\n                detailGoodsVisible: false,\r\n                GoodsInOrderVisible: false,\r\n                inOrder: {\r\n                    id: null,\r\n                    number: 0\r\n                },\r\n                inOrderName: ''\r\n            }\r\n        },\r\n        created() {\r\n            this.initGoods()\r\n        },\r\n        methods: {\r\n            goodsInOrder(goods) {  // 商品入库操作\r\n                this.inOrderName = goods.name\r\n                this.inOrder.id = goods.id\r\n                this.GoodsInOrderVisible = true\r\n            },\r\n            detailGoods(goods) {  // 查看商品的详细信息\r\n                goodsApi.get(goods.id).then(resp => {\r\n                    this.detailsGoods = resp.data.data\r\n                })\r\n\r\n                this.detailGoodsVisible = true\r\n            },\r\n            updateState(goods) {  // 更新商品状态\r\n                console.log(\"state = \" + goods.state)\r\n                goodsApi.updateState(goods.id, goods.state === 1 ? 0 : 1).then(resp => {\r\n                    this.pageFindGoods()\r\n                })\r\n            },\r\n            deleteGoods(goods) {  // 删除商品\r\n                this.$confirm('此操作将永久删除' + goods.name + '，并且连同删除其相关的订单信息, 是否继续?', '提示', {\r\n                    confirmButtonText: '确定',\r\n                    cancelButtonText: '取消',\r\n                    type: 'warning'\r\n                }).then(() => {\r\n                    console.log(\"id = \" + goods.id)\r\n                    goodsApi.deleteGoods(goods.id).then(resp => {\r\n                        if (resp.data.code === 200) {\r\n                            this.$message({\r\n                                type: 'success',\r\n                                message: '删除成功!'\r\n                            })\r\n                            this.pageFindGoods()\r\n                        } else {\r\n                            this.$message.error('删除失败，服务器出了点小问题')\r\n                        }\r\n                    })\r\n                }).catch(() => {\r\n                    this.$message({\r\n                        type: 'info',\r\n                        message: '已取消删除'\r\n                    })\r\n                })\r\n            },\r\n            addGoods() {  // 添加信息商品\r\n                if (!this.goodsVo.province) {\r\n                    this.$message.error('请选择省份')\r\n                    return\r\n                }\r\n                if (!this.goodsVo.city) {\r\n                    this.$message.error('请选择城市')\r\n                    return\r\n                }\r\n                if (!this.goodsVo.county) {\r\n                    this.$message.error('请选择区县')\r\n                    return\r\n                }\r\n                if (!this.goodsVo.name) {\r\n                    this.$message.error('请输入商品名称')\r\n                    return\r\n                }\r\n                if (!this.goodsVo.price) {\r\n                    this.$message.error('请输入商品价格')\r\n                    return\r\n                }\r\n                if (isNaN(this.goodsVo.price)) {\r\n                    this.$message.error('价格输入不正确')\r\n                    return\r\n                }\r\n                if (!this.goodsVo.description) {\r\n                    this.$message.error('请输入描述！')\r\n                    return\r\n                }\r\n                if (!this.goodsVo.img) {\r\n                    this.$message.error('请上传图片')\r\n                    return\r\n                }\r\n                goodsApi.add(this.goodsVo).then(resp => {\r\n                    if (resp.data.code === 200) {\r\n                        this.$message.success('添加成功！')\r\n                        this.addGoodsVisible = false\r\n                        this.pageFindGoods()\r\n                    } else {\r\n                        this.$message.error('添加失败！')\r\n                    }\r\n                })\r\n            },\r\n            initGoods() {  // 初始化页面函数\r\n                this.pageFindGoods()\r\n                this.getAllProvinces()\r\n            },\r\n            pageFindGoods() {  // 分页查找商品信息\r\n                goodsApi.pageFind(this.page, this.limit, this.goodsQueryVo).then(resp => {\r\n                    this.goodsList = resp.data.data.records\r\n                    this.total = resp.data.data.total\r\n                })\r\n            },\r\n            getAllProvinces() {  // 获取所有省\r\n\r\n                provinceApi.getAllProvinces().then(resp => {\r\n                    this.provinces = resp.data.data\r\n                })\r\n            },\r\n            getCities() {\r\n                this.goodsQueryVo.city = null\r\n                this.goodsQueryVo.county = null\r\n                this.getAllCitiesByParentId(this.goodsQueryVo.province)\r\n            },\r\n            getCitiesVo() {\r\n                this.goodsVo.city = null\r\n                this.goodsVo.county = null\r\n                this.getAllCitiesByParentId(this.goodsVo.province)\r\n            },\r\n            getAllCitiesByParentId(provinceId) {  // 获取省下所有市\r\n                this.cities = []\r\n                this.counties = []\r\n                cityApi.getAllCitiesByParentId(provinceId).then(resp => {\r\n                    this.cities = resp.data.data\r\n                })\r\n            },\r\n            getCountiesVo() {\r\n                this.goodsVo.county = null\r\n                this.getCountiesByParentId(this.goodsVo.city)\r\n            },\r\n            getCounties() {\r\n                this.goodsQueryVo.county = null\r\n                this.getCountiesByParentId(this.goodsQueryVo.city)\r\n            },\r\n            getCountiesByParentId(cityId) {  // 获取市下所有区县\r\n                this.counties = []\r\n                countyApi.getCountiesByParentId(cityId).then(resp => {\r\n                    this.counties = resp.data.data\r\n                })\r\n            },\r\n            handleSizeChange(limit) { // 一页数量修改\r\n                this.limit = limit\r\n                this.pageFindGoods()\r\n            },\r\n            handleCurrentChange(page) {  // 页码数量修改\r\n                this.page = page\r\n                this.pageFindGoods()\r\n            },\r\n            showAddGoodsVisible() {  // 打开对话框\r\n                this.goodsVo = {\r\n                    province: null,\r\n                    city: null,\r\n                    county: null,\r\n                    name: null,\r\n                    price: null,\r\n                    img: '',\r\n                    description: ''\r\n                }\r\n                this.addGoodsVisible = true\r\n            },\r\n            imgUploadSuccess(resp) {\r\n                this.goodsVo.img = resp.data\r\n                console.log(this.goodsVo.img)\r\n            },\r\n            handleRemove() {  // 删除图片操作\r\n                imgApi.deleteImage(this.goodsVo.img)\r\n                this.goodsVo.img = ''\r\n            },\r\n            cancelToAddGoods() {   // 取消添加 新商品\r\n                this.addGoodsVisible = false\r\n                this.handleRemove()\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    .avatar-uploader .el-upload {\r\n        border: 1px dashed #d9d9d9;\r\n        border-radius: 6px;\r\n        cursor: pointer;\r\n        position: relative;\r\n        overflow: hidden;\r\n    }\r\n\r\n    .avatar-uploader .el-upload:hover {\r\n        border-color: #409EFF;\r\n    }\r\n\r\n    .avatar-uploader-icon {\r\n        font-size: 28px;\r\n        color: #8c939d;\r\n        width: 178px;\r\n        height: 178px;\r\n        line-height: 178px;\r\n        text-align: center;\r\n    }\r\n\r\n    .avatar {\r\n        width: 178px;\r\n        height: 178px;\r\n        display: block;\r\n    }\r\n</style>"]},"metadata":{},"sourceType":"module"}