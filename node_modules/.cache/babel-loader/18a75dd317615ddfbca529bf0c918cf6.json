{"ast":null,"code":"// import adminApi from '@/api/admin/Admin'\n// import codeApi from '@/api/api/Code'\nexport default {\n  name: \"Header\",\n\n  data() {\n    return {\n      personInfoVisible: false,\n      passwordVisible: false,\n      isPhone: false,\n      // 是否使用手机验证码更新\n      checkPassword: '',\n      // 用于检查密码操作\n      personAdmin: {\n        // 用于保持个人信息\n        id: '',\n        name: '',\n        roleId: '',\n        username: '',\n        img: '',\n        phone: ''\n      },\n      updateAdmin: {\n        // 更新用户个人信息\n        id: '',\n        name: '',\n        username: '',\n        img: '',\n        phone: ''\n      },\n      updatePasswordByPassParams: {\n        // 使用密码更新密码\n        username: '',\n        password: '',\n        newPassword: ''\n      },\n      updatePasswordByPhoneParams: {\n        // 更新密码使用手机验证方式\n        phone: '',\n        password: '',\n        code: ''\n      }\n    };\n  },\n\n  created() {\n    this.getPersonInfo();\n  },\n\n  methods: {\n    getCode() {// 获取验证码\n      // codeApi.createCode(this.updatePasswordByPhoneParams.phone).then(resp => {\n      //     if (200 === resp.data.code) {\n      //         this.$message.success(resp.data.msg)\n      //         return\n      //     }\n      //     this.$message.error(resp.data.msg)\n      // })\n    },\n\n    userPhone() {\n      // 使用手机方式\n      this.isPhone = true;\n    },\n\n    usePass() {\n      // 使用密码方式\n      this.isPhone = false;\n    },\n\n    updatePassByPhone() {\n      // 更新密码方式采用手机验证码方式\n      if (!this.updatePasswordByPhoneParams.password) {\n        this.$message.error('请输入密码');\n        return;\n      }\n\n      if (!this.updatePasswordByPhoneParams.code) {\n        this.$message.error('请输入验证码');\n        return;\n      }\n\n      adminApi.updatePassByPhone(this.updatePasswordByPhoneParams).then(resp => {\n        if (200 === resp.data.code) {\n          this.clear(); // 密码修改成功 退出登录\n\n          this.$message.success(resp.data.msg);\n          return;\n        }\n\n        this.$message.error(resp.data.msg);\n      });\n    },\n\n    updatePassByPass() {\n      // 更新密码方式采用密码方式\n      if (!this.updatePasswordByPassParams.password) {\n        this.$message.error('请输入原密码');\n        return;\n      }\n\n      if (!this.updatePasswordByPassParams.newPassword) {\n        this.$message.error('请输入新密码');\n        return;\n      }\n\n      if (!this.checkPassword) {\n        this.$message.error('请确认新密码');\n        return;\n      }\n\n      if (this.updatePasswordByPassParams.newPassword !== this.checkPassword) {\n        this.$message.error('新密码两次输入不一致');\n      }\n\n      adminApi.updatePassByPass(this.updatePasswordByPassParams).then(resp => {\n        if (resp.data.code === 200) {\n          this.clear(); // 密码修改成功 退出登录\n\n          this.$message.success(resp.data.msg);\n          return;\n        }\n\n        this.$message.error(resp.data.msg);\n      });\n    },\n\n    updateInfo() {\n      // 更新个人信息\n      adminApi.updateInfo(this.updateAdmin).then(resp => {\n        if (resp.data.code === 200) {\n          this.$message.success(resp.data.msg);\n          this.personAdmin.img = this.updateAdmin.img;\n          this.personAdmin.name = this.updateAdmin.name;\n          this.personAdmin.phone = this.updateAdmin.phone;\n          this.personAdmin.username = this.updateAdmin.username;\n          return;\n        }\n\n        this.$message.error(resp.data.msg);\n      });\n      this.personInfoVisible = false;\n    },\n\n    imgUploadSuccess(img) {\n      // 上传头像成功，更新头像地址\n      this.updateAdmin.img = img;\n    },\n\n    getPersonInfo() {\n      // 获取用户的个人信息\n      adminApi.getPersonInfo().then(resp => {\n        window.sessionStorage.setItem('user', JSON.stringify(resp.data.data));\n        this.personAdmin = resp.data.data;\n      });\n    },\n\n    handleCommand(command) {\n      // 处理命令操作\n      if ('upInfo' === command) {\n        this.updateAdminInfo();\n        return;\n      }\n\n      if ('upPass' === command) {\n        this.updatePassword();\n        return;\n      }\n\n      if ('logout' === command) {\n        this.logout();\n      }\n    },\n\n    updateAdminInfo() {\n      // 更新用户信息\n      this.updateAdmin.id = this.personAdmin.id;\n      this.updateAdmin.img = this.personAdmin.img;\n      this.updateAdmin.name = this.personAdmin.name;\n      this.updateAdmin.phone = this.personAdmin.phone;\n      this.updateAdmin.username = this.personAdmin.username;\n      this.personInfoVisible = true;\n    },\n\n    updatePassword() {\n      // 更新密码\n      this.updatePasswordByPhoneParams.phone = this.personAdmin.phone;\n      this.updatePasswordByPassParams.username = this.personAdmin.username;\n      this.passwordVisible = true;\n    },\n\n    logout() {\n      // 退出登录\n      this.clear();\n      this.$message.success('退出登录');\n    },\n\n    clear() {\n      // 清除数据操作\n      adminApi.logout();\n      window.sessionStorage.clear(); // 清空 token 信息\n\n      this.$router.replace('/');\n    }\n\n  }\n};","map":{"version":3,"mappings":"AA2IA;AACA;AAEA;EACAA,cADA;;EAEAC;IACA;MACAC,wBADA;MAEAC,sBAFA;MAGAC,cAHA;MAGA;MACAC,iBAJA;MAIA;MACAC;QAAA;QACAC,MADA;QAEAP,QAFA;QAGAQ,UAHA;QAIAC,YAJA;QAKAC,OALA;QAMAC;MANA,CALA;MAaAC;QAAA;QACAL,MADA;QAEAP,QAFA;QAGAS,YAHA;QAIAC,OAJA;QAKAC;MALA,CAbA;MAoBAE;QAAA;QACAJ,YADA;QAEAK,YAFA;QAGAC;MAHA,CApBA;MAyBAC;QAAA;QACAL,SADA;QAEAG,YAFA;QAGAG;MAHA;IAzBA;EA+BA,CAlCA;;EAmCAC;IACA;EACA,CArCA;;EAsCAC;IACAC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA,CATA;;IAUAC;MAAA;MACA;IACA,CAZA;;IAaAC;MAAA;MACA;IACA,CAfA;;IAgBAC;MAAA;MACA;QACA;QACA;MACA;;MACA;QACA;QACA;MACA;;MACAC;QACA;UACA,aADA,CACA;;UACA;UACA;QACA;;QACA;MACA,CAPA;IAQA,CAjCA;;IAkCAC;MAAA;MACA;QACA;QACA;MACA;;MACA;QACA;QACA;MACA;;MACA;QACA;QACA;MACA;;MACA;QACA;MACA;;MACAD;QACA;UACA,aADA,CACA;;UACA;UACA;QACA;;QACA;MACA,CAPA;IAQA,CA1DA;;IA2DAE;MAAA;MACAF;QACA;UACA;UACA;UACA;UACA;UACA;UACA;QACA;;QACA;MACA,CAVA;MAWA;IACA,CAxEA;;IAyEAG;MAAA;MACA;IACA,CA3EA;;IA4EAC;MAAA;MACAJ;QACAK;QACA;MACA,CAHA;IAIA,CAjFA;;IAkFAC;MAAA;MACA;QACA;QACA;MACA;;MACA;QACA;QACA;MACA;;MACA;QACA;MACA;IACA,CA9FA;;IA+FAC;MAAA;MACA;MACA;MACA;MACA;MACA;MACA;IACA,CAtGA;;IAuGAC;MAAA;MACA;MACA;MACA;IACA,CA3GA;;IA4GAC;MAAA;MACA;MACA;IACA,CA/GA;;IAgHAC;MAAA;MACAV;MACAK,8BAFA,CAEA;;MACA;IACA;;EApHA;AAtCA","names":["name","data","personInfoVisible","passwordVisible","isPhone","checkPassword","personAdmin","id","roleId","username","img","phone","updateAdmin","updatePasswordByPassParams","password","newPassword","updatePasswordByPhoneParams","code","created","methods","getCode","userPhone","usePass","updatePassByPhone","adminApi","updatePassByPass","updateInfo","imgUploadSuccess","getPersonInfo","window","handleCommand","updateAdminInfo","updatePassword","logout","clear"],"sourceRoot":"src/views","sources":["Header.vue"],"sourcesContent":["<template>\r\n    <!-- 头部展示栏位 存放用户个人的一些操作信息 -->\r\n    <div class=\"header-container\">\r\n        <div class=\"sys-log\">\r\n            超市管理系统\r\n        </div>\r\n\r\n        <!-- 更改个人信息栏位 -->\r\n        <div>\r\n            <el-dialog\r\n                    title=\"更改信息\"\r\n                    :visible.sync=\"personInfoVisible\"\r\n                    width=\"40%\">\r\n                <span>\r\n                    <el-form ref=\"form\" :model=\"updateAdmin\">\r\n                        <el-row :gutter=\"24\">\r\n                            <el-col :span=\"8\">\r\n                                <div class=\"grid-content bg-purple\">\r\n                                    <el-form-item label=\"姓名\">\r\n                                        <el-input v-model=\"updateAdmin.name\" placeholder=\"请输入你的姓名\"></el-input>\r\n                                    </el-form-item>\r\n                                </div>\r\n                            </el-col>\r\n                            <el-col :span=\"8\">\r\n                                <div class=\"grid-content bg-purple\">\r\n                                    <el-form-item label=\"用户名\">\r\n                                        <el-input v-model=\"updateAdmin.username\" placeholder=\"请输入用户名\"></el-input>\r\n                                    </el-form-item>\r\n                                </div>\r\n                            </el-col>\r\n                            <el-col :span=\"8\">\r\n                                <div class=\"grid-content bg-purple\">\r\n                                    <el-form-item label=\"手机号码\">\r\n                                        <el-input v-model=\"updateAdmin.phone\" placeholder=\"请输入手机号码\"></el-input>\r\n                                    </el-form-item>\r\n                                </div>\r\n                            </el-col>\r\n                            <el-col :span=\"8\">\r\n                                <div class=\"grid-content bg-purple\">\r\n                                    <el-form-item label=\"头像\">\r\n                                        <el-image style=\"width: 100px; height: 100px\"\r\n                                                  :src=\"updateAdmin.img\"></el-image>\r\n                                    </el-form-item>\r\n                                </div>\r\n                            </el-col>\r\n                            <el-col :span=\"8\">\r\n                                <div class=\"grid-content bg-purple\">\r\n                                    <el-form-item label=\"更新头像\">\r\n                                        <el-upload\r\n                                                class=\"upload-demo\"\r\n                                                action=\"http://192.168.195.130:80/log/api/img/upload\"\r\n                                                multiple\r\n                                                :on-success=\"imgUploadSuccess\">\r\n                                        <el-button size=\"small\" type=\"primary\">点击上传</el-button>\r\n                                        <div slot=\"tip\" class=\"el-upload__tip\">只能上传jpg/png文件，且不超过2Mb</div>\r\n                                    </el-upload>\r\n                                    </el-form-item>\r\n                                </div>\r\n                            </el-col>\r\n                        </el-row>\r\n                    </el-form>\r\n                </span>\r\n                <span slot=\"footer\" class=\"dialog-footer\">\r\n                    <el-button @click=\"personInfoVisible = false\">取 消</el-button>\r\n                    <el-button type=\"primary\" @click=\"updateInfo\">确 定</el-button>\r\n                </span>\r\n            </el-dialog>\r\n        </div>\r\n\r\n        <!-- 更改密码栏位 -->\r\n        <div>\r\n            <el-dialog title=\"密码更改\"\r\n                       :visible.sync=\"passwordVisible\"\r\n                       width=\"30%\">\r\n                <span>\r\n                    <!-- 密码更改方式 -->\r\n                    <div class=\"password-style\" v-if=\"!isPhone\">\r\n                        <el-form :model=\"updatePasswordByPassParams\" status-icon\r\n                                 ref=\"updatePasswordByPassParams\" label-width=\"100px\"\r\n                                 class=\"demo-ruleForm\">\r\n                            <el-form-item label=\"原旧密码\">\r\n                                <el-input style=\"width: 85%\" type=\"password\"\r\n                                          v-model=\"updatePasswordByPassParams.password\"\r\n                                          autocomplete=\"off\">\r\n                                </el-input>\r\n                            </el-form-item>\r\n                            <el-form-item label=\"新的密码\">\r\n                                <el-input style=\"width: 85%\" type=\"password\"\r\n                                          v-model=\"updatePasswordByPassParams.newPassword\"\r\n                                          autocomplete=\"off\">\r\n                                </el-input>\r\n                            </el-form-item>\r\n                            <el-form-item label=\"确认密码\">\r\n                                <el-input style=\"width: 85%\" type=\"password\" v-model=\"checkPassword\" autocomplete=\"off\">\r\n                                </el-input>\r\n                            </el-form-item>\r\n                            <el-form-item>\r\n                                <el-button type=\"success\" @click=\"updatePassByPass\" plain>提交</el-button>\r\n                                <el-button @click=\"userPhone\" plain>使用手机</el-button>\r\n                                <el-button @click=\"passwordVisible = false\" plain>取 消</el-button>\r\n                            </el-form-item>\r\n                        </el-form>\r\n                    </div>\r\n                    <!-- 手机验证码更改方式 -->\r\n                    <div class=\"phone-style\" v-if=\"isPhone\">\r\n                        <el-form :model=\"updatePasswordByPhoneParams\" status-icon\r\n                                 ref=\"updatePasswordByPassParams\" label-width=\"100px\"\r\n                                 class=\"demo-ruleForm\">\r\n                            <el-form-item label=\"手机号码\">\r\n                                <el-input type=\"text\" v-model=\"updatePasswordByPhoneParams.phone\"\r\n                                          autocomplete=\"off\" disabled style=\"width: 85%\">\r\n                                </el-input>\r\n                            </el-form-item>\r\n                            <el-form-item label=\"新密码\">\r\n                                <el-input type=\"password\" v-model=\"updatePasswordByPhoneParams.password\"\r\n                                          autocomplete=\"off\" style=\"width: 85%\">\r\n                                </el-input>\r\n                            </el-form-item>\r\n                            <el-form-item label=\"验证码\">\r\n                                <el-input style=\"width: 50%\" type=\"text\" v-model=\"updatePasswordByPhoneParams.code\"\r\n                                          autocomplete=\"off\">\r\n                                </el-input>\r\n                                <el-button style=\"width: 35%\" type=\"primary\" @click=\"getCode\" plain>获取验证码</el-button>\r\n                            </el-form-item>\r\n                            <el-form-item>\r\n                                <el-button type=\"success\" @click=\"updatePassByPhone\" plain>提交</el-button>\r\n                                <el-button @click=\"usePass\" plain>原始方式</el-button>\r\n                                <el-button @click=\"passwordVisible = false\" plain>取 消</el-button>\r\n                            </el-form-item>\r\n                        </el-form>\r\n                    </div>\r\n                </span>\r\n            </el-dialog>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n\r\n    // import adminApi from '@/api/admin/Admin'\r\n    // import codeApi from '@/api/api/Code'\r\n\r\n    export default {\r\n        name: \"Header\",\r\n        data() {\r\n            return {\r\n                personInfoVisible: false,\r\n                passwordVisible: false,\r\n                isPhone: false,  // 是否使用手机验证码更新\r\n                checkPassword: '',  // 用于检查密码操作\r\n                personAdmin: {  // 用于保持个人信息\r\n                    id: '',\r\n                    name: '',\r\n                    roleId: '',\r\n                    username: '',\r\n                    img: '',\r\n                    phone: ''\r\n                },\r\n                updateAdmin: {  // 更新用户个人信息\r\n                    id: '',\r\n                    name: '',\r\n                    username: '',\r\n                    img: '',\r\n                    phone: ''\r\n                },\r\n                updatePasswordByPassParams: {  // 使用密码更新密码\r\n                    username: '',\r\n                    password: '',\r\n                    newPassword: ''\r\n                },\r\n                updatePasswordByPhoneParams: {  // 更新密码使用手机验证方式\r\n                    phone: '',\r\n                    password: '',\r\n                    code: ''\r\n                }\r\n            }\r\n        },\r\n        created() {\r\n            this.getPersonInfo()\r\n        },\r\n        methods: {\r\n            getCode() {  // 获取验证码\r\n                // codeApi.createCode(this.updatePasswordByPhoneParams.phone).then(resp => {\r\n                //     if (200 === resp.data.code) {\r\n                //         this.$message.success(resp.data.msg)\r\n                //         return\r\n                //     }\r\n                //     this.$message.error(resp.data.msg)\r\n                // })\r\n            },\r\n            userPhone() {  // 使用手机方式\r\n                this.isPhone = true\r\n            },\r\n            usePass() {    // 使用密码方式\r\n                this.isPhone = false\r\n            },\r\n            updatePassByPhone() {  // 更新密码方式采用手机验证码方式\r\n                if (!this.updatePasswordByPhoneParams.password) {\r\n                    this.$message.error('请输入密码')\r\n                    return\r\n                }\r\n                if (!this.updatePasswordByPhoneParams.code) {\r\n                    this.$message.error('请输入验证码')\r\n                    return\r\n                }\r\n                adminApi.updatePassByPhone(this.updatePasswordByPhoneParams).then(resp => {\r\n                    if (200 === resp.data.code) {\r\n                        this.clear()  // 密码修改成功 退出登录\r\n                        this.$message.success(resp.data.msg)\r\n                        return\r\n                    }\r\n                    this.$message.error(resp.data.msg)\r\n                })\r\n            },\r\n            updatePassByPass() {  // 更新密码方式采用密码方式\r\n                if (!this.updatePasswordByPassParams.password) {\r\n                    this.$message.error('请输入原密码')\r\n                    return\r\n                }\r\n                if (!this.updatePasswordByPassParams.newPassword) {\r\n                    this.$message.error('请输入新密码')\r\n                    return\r\n                }\r\n                if (!this.checkPassword) {\r\n                    this.$message.error('请确认新密码')\r\n                    return\r\n                }\r\n                if (this.updatePasswordByPassParams.newPassword !== this.checkPassword) {\r\n                    this.$message.error('新密码两次输入不一致')\r\n                }\r\n                adminApi.updatePassByPass(this.updatePasswordByPassParams).then(resp => {\r\n                    if (resp.data.code === 200) {\r\n                        this.clear()  // 密码修改成功 退出登录\r\n                        this.$message.success(resp.data.msg)\r\n                        return\r\n                    }\r\n                    this.$message.error(resp.data.msg)\r\n                })\r\n            },\r\n            updateInfo() {  // 更新个人信息\r\n                adminApi.updateInfo(this.updateAdmin).then(resp => {\r\n                    if (resp.data.code === 200) {\r\n                        this.$message.success(resp.data.msg)\r\n                        this.personAdmin.img = this.updateAdmin.img\r\n                        this.personAdmin.name = this.updateAdmin.name\r\n                        this.personAdmin.phone = this.updateAdmin.phone\r\n                        this.personAdmin.username = this.updateAdmin.username\r\n                        return\r\n                    }\r\n                    this.$message.error(resp.data.msg)\r\n                })\r\n                this.personInfoVisible = false\r\n            },\r\n            imgUploadSuccess(img) {  // 上传头像成功，更新头像地址\r\n                this.updateAdmin.img = img\r\n            },\r\n            getPersonInfo() {  // 获取用户的个人信息\r\n                adminApi.getPersonInfo().then(resp => {\r\n                    window.sessionStorage.setItem('user', JSON.stringify(resp.data.data))\r\n                    this.personAdmin = resp.data.data\r\n                })\r\n            },\r\n            handleCommand(command) {  // 处理命令操作\r\n                if ('upInfo' === command) {\r\n                    this.updateAdminInfo()\r\n                    return\r\n                }\r\n                if ('upPass' === command) {\r\n                    this.updatePassword()\r\n                    return\r\n                }\r\n                if ('logout' === command) {\r\n                    this.logout()\r\n                }\r\n            },\r\n            updateAdminInfo() {  // 更新用户信息\r\n                this.updateAdmin.id = this.personAdmin.id\r\n                this.updateAdmin.img = this.personAdmin.img\r\n                this.updateAdmin.name = this.personAdmin.name\r\n                this.updateAdmin.phone = this.personAdmin.phone\r\n                this.updateAdmin.username = this.personAdmin.username\r\n                this.personInfoVisible = true\r\n            },\r\n            updatePassword() {  // 更新密码\r\n                this.updatePasswordByPhoneParams.phone = this.personAdmin.phone\r\n                this.updatePasswordByPassParams.username = this.personAdmin.username\r\n                this.passwordVisible = true\r\n            },\r\n            logout() {  // 退出登录\r\n                this.clear()\r\n                this.$message.success('退出登录')\r\n            },\r\n            clear() {  // 清除数据操作\r\n                adminApi.logout()\r\n                window.sessionStorage.clear()  // 清空 token 信息\r\n                this.$router.replace('/')\r\n            }\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    .header-container {\r\n        height: 80px;\r\n        background-color: #7cb6aa;\r\n    }\r\n\r\n    .sys-log {\r\n        font-family: 华文楷体;\r\n        font-size: 50px;\r\n        float: left;\r\n        color: #303133;\r\n    }\r\n\r\n    .sys-avatar {\r\n        float: right;\r\n        padding: 15px 30px 0 0;\r\n    }\r\n\r\n    .sys-avatar:hover {\r\n        cursor: pointer;\r\n    }\r\n</style>"]},"metadata":{},"sourceType":"module"}